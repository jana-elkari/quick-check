<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Results - RE Quick Check</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
   <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
  <div class="container">
    <h2>Results</h2>

    {% if sankey_html %}
    <div class="recommendation-box">
      <h3>Causal Recommender Visualization</h3>
      {{ sankey_html | safe }}
    </div>
    {% endif %}

    {% if peers is not none and peers.shape[0] > 0 %}
    <div class="recommendation-box">
        <h3>Peer Company Benchmarking</h3>
        <p>
          Peer companies are defined as organizations in the 
          <strong>same continent</strong>, operating in the 
          <strong>same industry</strong>, and of 
          <strong>similar team size</strong> (Â±25%).
        </p>
        {% if statistics and statistics|length > 0 %}
        <ul class="recommendation-list">
            {% for stat in statistics %}
            {% if 'below' in stat %}
                <li><span style="color:red;">âœ–</span> {{ stat }}</li>
            {% elif 'above' in stat %}
                <li><span style="color:green;">âœ”</span> {{ stat }}</li>
            {% else %}
                <li><span style="color:orange;">âš </span> {{ stat }}</li>
            {% endif %}
            {% endfor %}
        </ul>
        {% else %}
        <p>No specific advice could be derived, but <strong>{{ peers.shape[0] }}</strong> peer companies were found.</p>
        {% endif %}
    </div>
    {% else %}
    <div class="recommendation-box">
        <h3>Peer Company Benchmarking</h3>
        <p>There are no statistics as peer companies are not available.</p>
    </div>
    {% endif %}

    <form method="GET" class="filter-form">
      <h3>Filter Benchmark Visuals</h3>
      <label for="filter_country">Filter by Country:</label>
      <select name="filter_country">
        <option value="">All</option>
        {% for country in countries %}
          <option value="{{ country }}" {% if filter_country == country %}selected{% endif %}>{{ country }}</option>
        {% endfor %}
      </select>

      <label for="filter_industry">Filter by Industry:</label>
      <select name="filter_industry">
        <option value="">All</option>
        {% for ind in industries %}
          <option value="{{ ind }}" {% if filter_industry == ind %}selected{% endif %}>{{ ind }}</option>
        {% endfor %}
      </select>

      <label for="filter_role">Filter by Role:</label>
      <select name="filter_role">
        <option value="">All</option>
        {% for role in roles %}
          <option value="{{ role }}" {% if filter_role == role %}selected{% endif %}>{{ role }}</option>
        {% endfor %}
      </select>

      <label for="filter_method">Filter by Project Method:</label>
      <select name="filter_method">
        <option value="">All</option>
        {% for method in methods %}
          <option value="{{ method }}" {% if filter_method == method %}selected{% endif %}>{{ method }}</option>
        {% endfor %}
      </select>

      <label for="filter_partners">Filter by External Partners:</label>
      <select name="filter_partners">
        <option value="">All</option>
        {% for p in partners %}
          <option value="{{ p }}" {% if filter_partners == p %}selected{% endif %}>{{ p }}</option>
        {% endfor %}
      </select>

      <label for="filter_distribution">Filter by Project Distribution:</label>
      <select name="filter_distribution">
        <option value="">All</option>
        {% for d in distributions %}
          <option value="{{ d }}" {% if filter_distribution == d %}selected{% endif %}>{{ d }}</option>
        {% endfor %}
      </select>
      <button type="submit">Apply Filters</button>
    </form>

    {% if plots %}
    <div class="benchmarks">
      <h3>Benchmark Visuals</h3>
      <div class="plot-grid">
        {% for name, plot_html in plots.items() %}
        <div class="plot-card">
          {% if name == "team_size" %}
            <p><strong>How many people are involved in your project?</strong></p>
          {% elif name == "role" %}
            <p><strong>What is the main role you occupy in your project?</strong></p>
          {% elif name == "industry" %}
            <p><strong>Please select the main industrial sector of your project or the application domain of the software you build.</strong></p>
          {% elif name == "team_customer_relationship" %}
            <p><strong>How would you rate the relationship between your projectâ€™s team and its customer? (1â€“5)</strong></p>
          {% elif name == "external_partners" %}
            <p><strong>Does your project involve external partners?</strong></p>
          {% elif name == "failed_documentation" %}
            <p><strong>Have you ever failed to document one or more requirements?</strong></p>
          {% elif name == "project_distribution" %}
            <p><strong>Is your project distributed?</strong></p>
          {% elif name == "work" %}
            <p><strong>Do you tend to work from home, on-site, or both?</strong></p>
          {% elif name == "requirements_elicitation" %}
            <p><strong>How are the requirements elicited in your project?</strong></p>
          {% elif name == "elicitation_techniques" %}
            <p><strong>Which techniques do you use for requirements elicitation? (Select all that apply)</strong></p>
          {% elif name == "explicit_distinction" %}
            <p><strong>Which aspects do you explicitly distinguish when specifying requirements? (Select all that apply)</strong></p>
          {% elif name == "team_communication" %}
            <p><strong>How would you rate the quality of communication inside your team?</strong></p>
          {% elif name == "project_method" %}
            <p><strong>How would you personally characterise the way your project works?</strong></p>
          {% elif name == "country" %}
            <p><strong>In which country are you personally located?</strong></p>
          {% elif name == "common_problem" %}
            <p><strong>Top 1 Problem (most critical)</strong></p>
          {% elif name == "user_feedback_frequency" %}
            <p><strong>How often is user feedback provided?</strong></p>
          {% elif name == "non_functional_requirements" %}
            <p><strong>Which classes of non-functional requirements do you explicitly consider in your requirements documentation?</strong></p>
          {% elif name == "meeting_frequency" %}
            <p><strong>How often do members of your team meet, informally by chance meeting or in announced meetings?</strong></p>
          {% elif name == "doc_willing" %}
            <p><strong>I produce the document willingly because I know it's essential.</strong></p>
          {% elif name == "communication_with_other_teams" %}
            <p><strong>How would you rate the quality of communication between your team and other teams on the same project?</strong></p>
          {% elif name == "doc_unwilling_but_produce" %}
            <p><strong>I produce the document unwillingly but still produce it.</strong></p>
          {% elif name == "doc_dont_produce" %}
            <p><strong>I don't produce the document, because the current members of the project do not need it.</strong></p>
          {% elif name == "requirements_testing_alignment" %}
            <p><strong>How do you align software testing with requirements?</strong></p>
          {% elif name == "assumption" %}
            <p><strong>If you are in a situation where you lack information and have to make an assumption to proceed in your project, what do you typically do?</strong></p>
          {% elif name == "requirements_documentation" %}
            <p><strong>How do you document requirements?</strong></p>
          {% elif name == "no_documentation_reasons" %}
            <p><strong>Check as many reasons for failing to document requirements that have applied in at least one circumstance.</strong></p>
          {% elif name == "top2" %}
            <p><strong>Top 2 Problem (most critical)</strong></p>
          {% elif name == "top3" %}
            <p><strong>Top 3 Problem (most critical)</strong></p>
          {% elif name == "top4" %}
            <p><strong>Top 4 Problem (most critical)</strong></p>
          {% elif name == "top5" %}
            <p><strong>Top 5 Problem (most critical)</strong></p>
          {% else %}
            <p><strong>{{ name.replace('_',' ').title() }}</strong></p>
          {% endif %}

          <!-- âœ… Insert Plotly plot -->
          <div class="plotly-plot">
            {{ plot_html | safe }}
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <a href="{{ url_for('survey') }}" class="btn">ðŸ”„ Resubmit Answers</a>
  </div>
</body>
</html>
